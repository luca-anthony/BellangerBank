<!DOCTYPE html>
<html>
<head>
<title>Admin Panel</title>
<style>
body { font-family: Arial; text-align: center; background: #fafafa; }
table { margin: 20px auto; border-collapse: collapse; width: 90%; }
th, td { border: 1px solid #ddd; padding: 8px; }
th { background: #0074D9; color: white; }
input, button, select { padding: 5px; margin: 5px; }
button { background: #0074D9; color: white; border: none; border-radius: 5px; }
button:hover { background: #005fa3; }
</style>
</head>
<body>
<h1>ğŸ‘¨â€ğŸ« Admin Panel</h1>

<h2>Adjust Balances</h2>
<form method="post">
    <select name="class" required>
        {% for class_name in classes.keys() %}
        <option value="{{ class_name }}">{{ class_name.replace('_',' ').title() }}</option>
        {% endfor %}
    </select>
    <input name="student" placeholder="Student username" required>
    <input name="amount" type="number" step="0.01" placeholder="Amount (can be negative)" required>
    <button type="submit">Apply</button>
</form>

<h2>Classes & Students</h2>
{% for class_name, class_data in classes.items() %}
<h3>{{ class_name.replace('_',' ').title() }} <a href="{{ url_for('add_students', class_name=class_name) }}">Add Students: Admin</a></h3>
<table>
<tr><th>Name</th><th>Balance</th><th>Savings</th><th>Locked Until</th></tr>
{% for name, data in class_data['students'].items() %}
<tr>
<td>{{ name }}</td>
<td>${{ "%.2f"|format(data['balance']) }}</td>
<td>${{ "%.2f"|format(data['savings_balance']) }}</td>
<td>{{ data['lock_until'].strftime("%Y-%m-%d") if data['lock_until'] else "â€”" }}</td>
</tr>
{% endfor %}
</table>
{% endfor %}

<h2>ğŸ›ï¸ Orders</h2>
{% for class_name, class_data in classes.items() %}
<h3>{{ class_name.replace('_',' ').title() }}</h3>
<table>
<tr><th>Student</th><th>Item</th><th>Date</th><th>Status</th><th>Action</th></tr>
{% for name, data in class_data['students'].items() %}
{% for idx, o in enumerate(data['orders']) %}
<tr>
<td>{{ name }}</td>
<td>{{ o['item'] }}</td>
<td>{{ o['date'] }}</td>
<td>{{ o['status'] }}</td>
<td>
{% if o['status'] == "Pending" %}
<a href="{{ url_for('approve_order', class_name=class_name, student=name, idx=idx) }}">âœ… Approve</a>
<form action="{{ url_for('deny_order', class_name=class_name, student=name, idx=idx) }}" method="post" style="display:inline;">
<input type="text" name="reason" placeholder="Reason" required>
<button type="submit">âŒ Deny</button>
</form>
{% else %}
{{ o['status'] }}
{% endif %}
</td>
</tr>
{% endfor %}
{% endfor %}
</table>
{% endfor %}

<p><a href="{{ url_for('logout') }}">Logout</a></p>
</body>
</html>
